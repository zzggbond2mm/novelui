# 韩中小说翻译工具使用指南

本工具用于将韩文小说自动翻译成中文，并在翻译过程中自动更新术语库，确保翻译一致性。**本工具已完成测试，可正常使用。**

## 准备工作

1. **安装Python环境**
   - 确保您已安装Python 3.9或更高版本
   - 可在[Python官网](https://www.python.org/downloads/)下载安装

2. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

3. **配置API密钥**
   - 复制`.env.example`文件并重命名为`.env`
   - 在`.env`文件中填入API相关配置
   ```
   API_URL="您的API地址"
   API_KEY="您的API密钥"
   MODEL="您使用的模型"
   # 可选：添加多个API密钥用于并行翻译
   API_KEY_1="您的额外API密钥1"
   API_KEY_2="您的额外API密钥2"
   # ... 可添加更多密钥
   ```

4. **准备目录结构**
   - 在上层目录创建`韩文稿`文件夹，并在其中为每部小说创建子文件夹
   - 将韩文原文放入对应小说名称的文件夹中，文件名应包含数字编号（如`00001.md`、`chapter1.md`等）

## 使用方法

基本使用格式：
```bash
python main.py --novel "小说名称" [选项]
```

### 常用选项

- `--novel`：必需，小说名称，对应源文件和目标文件的目录名
- `--start`：起始文件编号
- `--count`：要翻译的文件数量
- `--file`：单一文件编号（只翻译一个文件）
- `--range`：文件编号范围，格式如 '1-10'
- `--force`：强制重新翻译已完成的文件
- `--reset`：重置进度（慎用）
- `--debug`：启用调试日志
- `--parallel`：启用并行翻译模式
- `--workers`：并行工作线程数量（默认为3，最大不超过可用API密钥数量）

### 使用示例

1. **从第5章开始翻译20章**
   ```bash
   python main.py --novel "小说名称" --start 5 --count 20
   ```

2. **翻译第10到15章**
   ```bash
   python main.py --novel "小说名称" --range 10-15
   ```

3. **只翻译第8章**
   ```bash
   python main.py --novel "小说名称" --file 8
   ```

4. **强制重新翻译第8章**
   ```bash
   python main.py --novel "小说名称" --file 8 --force
   ```

5. **使用并行模式翻译**
   ```bash
   python main.py --novel "小说名称" --range 1-30 --parallel --workers 5
   ```

## 翻译流程

本工具支持两种翻译模式：

### 串行翻译流程（默认）

1. **自动顺序处理**：按指定顺序（起始编号、数量、范围）处理输入文件
2. **动态术语库更新**：每翻译完一个文件，系统会自动分析译文并更新术语库
3. **术语一致性保证**：下一个文件的翻译会使用更新后的术语库，确保整部小说术语使用一致
4. **断点续传**：翻译过程可随时中断，重启后自动从中断处继续

### 并行翻译流程（使用 --parallel 选项）

1. **多线程翻译**：同时处理多个输入文件，显著提高翻译速度
2. **API密钥轮换**：自动在多个API密钥间轮换，避免单个密钥达到使用限制
3. **术语库同步**：通过安全的并发控制机制确保术语库更新不会冲突
4. **实时进度显示**：显示每个并行任务的状态和整体进度
5. **智能错误处理**：任何单个任务失败不会影响整体进程

## 文件结构

- `main.py`：主程序入口
- `config.py`：配置管理
- `api_client.py`：API调用逻辑
- `terminology_manager.py`：术语库管理
- `file_handler.py`：文件读写
- `prompt_builder.py`：提示构建
- `progress_tracker.py`：进度跟踪
- `utils.py`：辅助函数
- `parallel_manager.py`：并行翻译管理（新增）
- `check_progress.py`：查看翻译进度的独立工具
- `术语库/`：存储术语JSON文件
  - `character.json`：人物名称
  - `proper_nouns.json`：专有名词
  - `cultural_expressions.json`：文化表达
- `prompt/`：存储提示模板
  - `translate_prompt.md`：翻译提示
  - `update_terminology_prompt.md`：术语更新提示
- `logs/`：日志文件（运行时自动创建）
- `进度/`：进度记录（运行时自动创建）

## 输出

- 翻译结果将保存在上层目录的`中文稿/{小说名}/`文件夹中
- 文件名格式为`中_00001.md`等
- 术语库会在翻译过程中自动更新
- 进度信息保存在`进度/{小说名}_progress.json`文件中

## 注意事项

1. API调用可能会产生费用，请关注您的API配额使用情况
2. 翻译速度受API响应时间和文件大小影响
3. 如遇到翻译失败，可使用`--force`选项重新翻译特定文件
4. 程序会自动记录进度，可以随时中断后继续执行
5. 术语库的内容会影响翻译质量，可以在翻译前手动编辑术语库文件添加关键术语
6. 并行翻译模式需要配置多个API密钥才能发挥最大效率
7. 设置过多的并行工作线程可能导致API调用频率限制，建议根据可用API密钥数量来设置

## 性能对比

在翻译相同内容的情况下：

| 翻译模式 | 10章翻译耗时 | 资源占用 | 适用场景 |
|---------|------------|--------|---------|
| 串行模式 | 约20-30分钟 | 低     | 术语一致性要求高、资源有限 |
| 并行模式(5线程) | 约5-8分钟 | 中高 | 快速翻译大量内容、有多个API密钥 |

## 当前限制与未来改进

1. **长文本处理**：当前版本对于超过API单次请求限制的长章节可能需要手动分割
2. **术语冲突处理**：可能会进一步优化术语合并逻辑，处理AI提出的不准确术语
3. **用户界面**：计划开发简单的Web界面，方便不熟悉命令行的用户使用
4. **并行效率优化**：计划进一步优化并行处理的效率和稳定性

如有问题或建议，请参考项目开发文档`readme_dev.md`获取更多技术细节。

